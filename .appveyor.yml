version: 1.0.{build}
branches:
  only:
  - ci/all
  - ci/appveyor

environment:
  ASIOSDK: C:\projects\ASIOSDK2.3
  image: Visual Studio 2015
  PYTHON: "C:\\Python27"
  matrix:
    - platform: Win32
      configuration: Release_32bit
    - platform: x64
      configuration: Release

before_build:
  - "python --version"
  - "pip install future"
  - ps: |
      echo "submodule"
      git submodule -q update --init --recursive
      cd C:\projects\lgml\third_party\rubberband
      echo 'building rubberband'
      msbuild C:\projects\lgml\third_party\rubberband\rubberband-library.sln /p:Configuration=Release /m:4
      echo 'dowloading JUCE'
      wget https://codeload.github.com/WeAreROLI/JUCE/zip/master -OutFile JUCE.zip
      7z x JUCE.zip -o"C:\projects" -y
      Rename-Item -path ‘C:\projects\JUCE-master’ -newName ‘JUCE’
      echo 'downloading ASIOSDK'
      wget http://www.steinberg.net/sdk_downloads/asiosdk2.3.zip -OutFile ASIO_SDK.zip
      7z x ASIO_SDK.zip -o"C:\projects" -y


after_build:
  cmd: 7z a %APPVEYOR_BUILD_FOLDER%\LGML_%PLATFORM%.zip %APPVEYOR_BUILD_FOLDER%\Builds\VisualStudio2015\%PLATFORM%\%CONFIGURATION%\App\*.exe

on_success:
  cmd: python %APPVEYOR_BUILD_FOLDER%\Scripts\PyUtils\OwncloudUtils.py %APPVEYOR_BUILD_FOLDER%\LGML_%PLATFORM%.zip DEVSPECTACLES/Tools/LGML/App-Dev/dist/bleedingEdge/LGML_%PLATFORM%.zip

artifacts:
  - path: LGML_$(platform).zip

build:
  project: Builds/VisualStudio2015/LGML.sln
  verbosity: minimal
  parallel: true